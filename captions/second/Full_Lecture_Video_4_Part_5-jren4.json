[{"text":"/bin/ls hurray! finally we've got a basic shell that takes a single command","width":618},{"text":"we can't give it any arguments yet but we can execute it","width":233},{"text":"and woah hold on a moment, it stopped!","width":276},{"text":"what happened to my while loop?","width":424},{"text":"perhaps your neighbor knows why it didn't work?","width":258},{"text":"[silence]","width":2556},{"text":"okay we have another problem as well, in our assignment in running about that while loop, we've just written code which is actually kind of dangerous","width":581},{"text":"we made a assumption that the newline is always going to be there","width":363},{"text":"is that true?","width":329},{"text":"so it could appear to be true if we're testing it","width":199},{"text":"but it could be that someone is sending us data from a file and fgets simply returns because there is nothing left to read","width":595},{"text":"so a safer program might check to see what we're actually replacing","width":307},{"text":"so for example, it only make sense to do this if len is at least zero","width":311},{"text":"and the buffer[len - 1] is what we expect, a new line character","width":1284},{"text":"okay so we've now got a safer program, it still works, but our while loop never happens, why?","width":683},{"text":"yes thank you, our little process has had a mind wipe ","width":346},{"text":"its assembly language has disappeared, it's variables have disappeared","width":368},{"text":"basically everything we might have put inside the processes' memory is gone","width":271},{"text":"to be replaced by the code associated with our program ls","width":554},{"text":"so how do we make a shell? how do we make it so that it can execute more things","width":299},{"text":"fork exec, yes! so our plan is to do this","width":320},{"text":"in the child and in the parent we want to play our standard waitpid and then the exited stuff so that we can print out useful messages when our programs finish","width":938},{"text":"and that is the basis of the mp","width":544},{"text":"alright so we're well on our way to having a working shell","width":448},{"text":"in real shells, you can execute things in the background, how do we do this?","width":631},{"text":"don't call waitpid, just in your shell go around again","width":462},{"text":"go back to your line that reads input, either fgets or readline ","width":315},{"text":"and let that child process carry on","width":406},{"text":"how do we make it so that we can read from a file?","width":284},{"text":"well we've got two possible ways to do that","width":169},{"text":"you could use say fopen or if you want to go low level, you could use open","width":480},{"text":"and then when you call fgets you can pass in the file descriptor you get from fopen and you would read from that file descriptor","width":1072},{"text":"there is another way as well, which is to close standard in so you would say hey close zero","width":529},{"text":"and then call open","width":305},{"text":"and pass in the right arguments to read from a file","width":648},{"text":"and we need to read the manpage of open to look at how we can open a file readonly for example","width":496},{"text":"and when we do that, future reads at the C level will be reading from this source file","width":528},{"text":"how about this? suppose I want to execute file.c inside a child","width":488},{"text":"but now I want to redirect the output of this command to a different file","width":516},{"text":"how would I do that?","width":571},{"text":"so how do, ah right, so I'm not going to try and change cat, this is just a command, I want my shell to do this part","width":353},{"text":"I want my shell so that the output goes to a different output","width":661},{"text":"okay and where would I do that?","width":263},{"text":"here's a suggestion: you could after the fork, inside the child code, the child could close one, use open and then call exec","width":1592},{"text":"we saw an example of this in a previous lecture where we made our program send the output of ls I believe to a log file","width":610},{"text":"so all we've really done is taken that idea and put it inside the code that we're writing for the child process","width":677},{"text":"and we've put it inside the child because our parent is going to go around that loop and execute other commands","width":390},{"text":"and we don't want everything to end up inside that log file, inside say output.txt, we only want the child to execute that code","width":852}]